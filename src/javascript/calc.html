<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Calculator</title>
  <script type="text/javascript" src="arith-plugin.js"></script>

  <script type="text/javascript">
    /**
     * Author: Brian Gianforcaro bjg1955@cs.rit.edu
     * PLC Lab #3: JavaScript 
     */

    var model = new Arith(); 

    /**
     * Short hand for doc.createElem..(..)
     * @param 
     */

    function newElm( str ) {
      return document.createElement( str );
    }

    /**
     * Short-Hand function to call doc.getElembyId(...)
     * @param el - element to snag from the DOM.
     * @return The selected id
     */
    function byId( el ) { 
      return document.getElementById( el );
    }

    
    /**
     * Intialize the controller, buttons.
     * @param btnCanvas - Tag to attatch button's to.
     */
    function initController( btnCanvas ) {

      /** Helper function to build buttons in table */
      function appendTree( tr, td, btn ) {
        td.appendChild( btn );
        tr.appendChild( td );
      }

      /** Helper function to abstract away boiler plate button creation */
      function makeButton( tr, name ) {
        td = newElm('td');
        btn = newElm('button');
        btn.innerHTML = name;
        appendTree( tr, td, btn );
        return btn;
      }

      /* Obtain operations form the model */
      var ops = [];
      for( prop in model.opNames ) {
        ops.push(prop);
      }
      
      aux = { "C":"action", 
              "0":"model.stack.push( 0 );",
              "E":"model.enter();" }

      for( row = 3; row >= 0 ; row-- ) {
        tr = newElm('tr');

        if ( row != 0 ) {
          for( col = (row * 3) - 2; col <= (row * 3); col++ ) {
            button = makeButton( tr, col )
            button.onClick="model.stack.push(" + col + ");";
          }
        } else {
          for ( op in aux ) {
              button = makeButton( tr, op );
              button.onClick = aux[op];
          }
        }

        op = model.opNames[ops[row]];

        button = makeButton( tr, ops[row] )
        button.onclick="mode.opList[" + op + "];";

        btnCanvas.appendChild( tr );
      }


    }

    function initView() {

      /* Create the table and set it's properties */
      table = byId('canvas');

      tr = newElm('tr');
      td = newElm('td');
      td.colSpan = 4;


      input = newElm('input');
      input.type = "text";

      btnbody = newElm('tbody');
      btnbody.id = "button-canvas";

      /* Constuct the table of all indvidual elements. */
      td.appendChild( input );
      tr.appendChild( td );
      btnbody.appendChild( tr );
      table.appendChild( btnbody );

      /* Append the final table to the canvas */
      initController( btnbody );
    }

    </script>

</head>
<body onload="initView();">
    <table id="canvas" border="0" align="center">
    </table>
</body>
</html>
